# Barnard Constitution

Barnard は「BLEセンシング基盤」として、複数クライアント（Flutter / React Native / iOS / Android）で同等の品質と挙動を提供するためのコアSDK群である。

## Core Principles

### I. Native-Core First（ネイティブSDKがコア）
- BLEの本質的な挙動（スキャン/広告、制約対応、イベント生成、観測性）は iOS/Android のネイティブSDKに実装する。
- Flutter / React Native は薄いラッパーとし、概念モデルとイベント契約を揃えて露出する。
- 「フレームワーク差」により挙動が変わらないことを優先する。

### II. Contract First（イベントモデルは契約）
- Barnard の主要成果物は「イベントモデル（メイン + デバッグ）」である。
- 破壊的変更は最小化し、必要な場合は明示的なバージョニングで扱う。
- 不明確な挙動（OS差分、権限、バックグラウンド制約）は“隠す”のではなく、上位が判断できる情報として返す。

### III. Explicit State Machine（状態と遷移を第一級に）
- スキャン/広告の状態（例: `idle / scanning / advertising / error`）を明確に定義し、遷移をイベントとして提供する。
- APIは“呼べた/呼べない”よりも、“今どの状態で、なぜそうなったか”が分かる設計にする。

### IV. Observability without PII（オタク向け観測は強力に、しかし安全に）
- `debugEvents` は「デバッグに必要な情報」に限定し、秘密情報・PII・追跡可能性が高いデータを含めない。
- イベント量が増える前提で、サンプリング・集約・バッファ上限などの制御を設計に含める。
- デバッグのための内部情報は“UI”ではなく“データ”として提供する（可視化はクライアント側）。

### V. Responsibility Boundary（責務境界を守る）
- Barnard の責務は BLEセンシング（スキャン/広告）と、その結果・制約・観測性イベントの提供まで。
- VC発行/検証、POAP発行、特定サーバAPI依存、UI実装などのドメインロジックは非責務。

### VI. Simple, Portable, Publishable（シンプルで移植可能、配布可能）
- 依存を最小化し、プラットフォームの標準配布経路（SPM / Maven / pub.dev / npm）に乗せやすい構成を優先する。
- “プロトタイプでも将来のコア化ができる”ように、責務分離と契約を先に固める。

## Non-Goals / Constraints

- Barnard は特定のサーバURLやAPI仕様に依存しない（アプリ側で実装する）。
- Barnard 単体で完全な不正耐性（電波偽装/リレー攻撃等）を解決しない（制約として明文化する）。
- 署名鍵などの秘密情報は保持・露出しない。

## Quality Gates / Workflow

- 変更は「仕様（spec）→ 計画（plan）→ タスク（tasks）→ 実装」の順で反映する。
- イベント契約に影響する変更は、必ず仕様へ追記し、サンプルまたはテストで検証可能にする。
- デバッグイベントは安全性（PII/秘密情報）と量（頻度/保持上限）の観点でレビューする。

## Governance
- 本憲法は Barnard に関する意思決定の最上位ルールであり、以後の仕様・計画・実装はこれに従う。
- 破壊的変更（互換性のない変更）や責務変更は、憲法/仕様に明記し、移行手順を伴う。

**Version**: 0.1.0 | **Ratified**: 2025-12-15 | **Last Amended**: 2025-12-15
